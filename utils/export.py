"""
Export Module - Export content to multiple formats
Supports JSON, TXT, and formatted educational documents
"""

import json
from datetime import datetime
from typing import Dict

class ContentExporter:
    
    @staticmethod
    def to_json(content: Dict, metadata: Dict = None) -> str:
        """Export to JSON format"""
        export_data = {
            "metadata": metadata or {
                "exported_at": datetime.now().isoformat(),
                "format": "json",
                "version": "1.0"
            },
            "content": content
        }
        return json.dumps(export_data, indent=2)
    
    @staticmethod
    def to_text(content: Dict, grade: int, topic: str) -> str:
        """Export to formatted text document"""
        lines = []
        lines.append("=" * 70)
        lines.append(f"EDUCATIONAL CONTENT - GRADE {grade}")
        lines.append(f"Topic: {topic}")
        lines.append(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        lines.append("=" * 70)
        lines.append("")
        
        # Explanation section
        lines.append("EXPLANATION:")
        lines.append("-" * 70)
        lines.append(content.get('explanation', 'No explanation provided'))
        lines.append("")
        
        # MCQs section
        lines.append("MULTIPLE CHOICE QUESTIONS:")
        lines.append("-" * 70)
        
        mcqs = content.get('mcqs', [])
        for i, mcq in enumerate(mcqs, 1):
            lines.append(f"\nQuestion {i}:")
            lines.append(f"  {mcq.get('question', '')}")
            lines.append("")
            
            for option in mcq.get('options', []):
                lines.append(f"  {option}")
            
            lines.append("")
            lines.append(f"  âœ“ Correct Answer: {mcq.get('answer', 'N/A')}")
            lines.append("")
        
        lines.append("=" * 70)
        lines.append("End of Document")
        lines.append("=" * 70)
        
        return "\n".join(lines)
    
    @staticmethod
    def to_markdown(content: Dict, grade: int, topic: str, review: Dict = None) -> str:
        """Export to Markdown format"""
        lines = []
        lines.append(f"# Educational Content - Grade {grade}")
        lines.append(f"**Topic:** {topic}")
        lines.append(f"**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        lines.append("")
        
        # Explanation
        lines.append("## ğŸ“– Explanation")
        lines.append("")
        lines.append(content.get('explanation', 'No explanation provided'))
        lines.append("")
        
        # MCQs
        lines.append("## â“ Multiple Choice Questions")
        lines.append("")
        
        mcqs = content.get('mcqs', [])
        for i, mcq in enumerate(mcqs, 1):
            lines.append(f"### Question {i}")
            lines.append(f"{mcq.get('question', '')}")
            lines.append("")
            
            for option in mcq.get('options', []):
                lines.append(f"- {option}")
            
            lines.append("")
            lines.append(f"**âœ“ Answer:** {mcq.get('answer', 'N/A')}")
            lines.append("")
        
        # Review section if available
        if review:
            lines.append("## ğŸ” Quality Review")
            lines.append("")
            status = review.get('status', 'unknown')
            status_emoji = "âœ…" if status == "pass" else "âŒ"
            lines.append(f"**Status:** {status_emoji} {status.upper()}")
            lines.append("")
            
            feedback = review.get('feedback', [])
            if feedback:
                lines.append("**Feedback:**")
                for item in feedback:
                    lines.append(f"- {item}")
                lines.append("")
        
        lines.append("---")
        lines.append("*Generated by Educational Content Generator*")
        
        return "\n".join(lines)
    
    @staticmethod
    def to_study_guide(content: Dict, grade: int, topic: str) -> str:
        """Export as a study guide format"""
        lines = []
        lines.append("â•”" + "â•" * 68 + "â•—")
        lines.append(f"â•‘{' ' * 20}STUDY GUIDE - GRADE {grade}{' ' * (48 - len(str(grade)))}â•‘")
        lines.append("â•š" + "â•" * 68 + "â•")
        lines.append("")
        lines.append(f"ğŸ“š Topic: {topic}")
        lines.append(f"ğŸ“… Date: {datetime.now().strftime('%B %d, %Y')}")
        lines.append("")
        lines.append("â”€" * 70)
        lines.append("")
        
        # Key Concepts
        lines.append("ğŸ¯ KEY CONCEPTS:")
        lines.append("")
        lines.append(content.get('explanation', 'No explanation provided'))
        lines.append("")
        lines.append("â”€" * 70)
        lines.append("")
        
        # Practice Questions
        lines.append("âœï¸  PRACTICE QUESTIONS:")
        lines.append("")
        
        mcqs = content.get('mcqs', [])
        for i, mcq in enumerate(mcqs, 1):
            lines.append(f"[Q{i}] {mcq.get('question', '')}")
            lines.append("")
            
            for option in mcq.get('options', []):
                lines.append(f"    {option}")
            lines.append("")
        
        # Answer Key
        lines.append("â”€" * 70)
        lines.append("")
        lines.append("ğŸ”‘ ANSWER KEY:")
        lines.append("")
        
        for i, mcq in enumerate(mcqs, 1):
            lines.append(f"Question {i}: {mcq.get('answer', 'N/A')}")
        
        lines.append("")
        lines.append("â”€" * 70)
        lines.append("ğŸ’¡ Study Tips:")
        lines.append("â€¢ Review the key concepts carefully")
        lines.append("â€¢ Try answering questions without looking at options")
        lines.append("â€¢ Understand why each answer is correct")
        lines.append("â€¢ Practice explaining concepts in your own words")
        lines.append("")
        
        return "\n".join(lines)
    
    @staticmethod
    def to_teacher_version(content: Dict, grade: int, topic: str, review: Dict = None) -> str:
        """Export with teacher notes and review details"""
        lines = []
        lines.append("â”Œ" + "â”€" * 68 + "â”")
        lines.append(f"â”‚  TEACHER'S VERSION - Grade {grade}: {topic}{' ' * (68 - len(topic) - len(str(grade)) - 27)}â”‚")
        lines.append("â””" + "â”€" * 68 + "â”˜")
        lines.append("")
        
        # Teaching notes
        lines.append("ğŸ“‹ TEACHING NOTES:")
        lines.append("")
        lines.append(f"Target Grade: {grade}")
        lines.append(f"Topic: {topic}")
        lines.append(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M')}")
        
        if review:
            status = review.get('status', 'unknown')
            lines.append(f"Quality Status: {'âœ… Passed' if status == 'pass' else 'âš ï¸ Needs Review'}")
        
        lines.append("")
        lines.append("â”€" * 70)
        lines.append("")
        
        # Content
        lines.append("ğŸ“– EXPLANATION (for students):")
        lines.append("")
        lines.append(content.get('explanation', ''))
        lines.append("")
        
        # Questions with detailed answers
        lines.append("â”€" * 70)
        lines.append("")
        lines.append("â“ ASSESSMENT QUESTIONS:")
        lines.append("")
        
        mcqs = content.get('mcqs', [])
        for i, mcq in enumerate(mcqs, 1):
            lines.append(f"Question {i}:")
            lines.append(f"  {mcq.get('question', '')}")
            lines.append("")
            lines.append("  Options:")
            
            answer = mcq.get('answer', '')
            for option in mcq.get('options', []):
                marker = "  âœ“" if option.startswith(answer) else "  â—‹"
                lines.append(f"  {marker} {option}")
            
            lines.append("")
            lines.append(f"  ğŸ“Œ Correct Answer: {answer}")
            lines.append("")
        
        # Review feedback if available
        if review and review.get('feedback'):
            lines.append("â”€" * 70)
            lines.append("")
            lines.append("ğŸ” QUALITY REVIEW NOTES:")
            lines.append("")
            for item in review.get('feedback', []):
                lines.append(f"  â€¢ {item}")
            lines.append("")
        
        lines.append("â”€" * 70)
        lines.append("Generated by Educational Content Generator AI System")
        
        return "\n".join(lines)
